#!/bin/sh

muted=false

if which wpctl &>/dev/null; then
  if ! wpctl get-volume @DEFAULT_AUDIO_SINK@ | grep -q "\[MUTED\]$"; then
    wpctl set-mute @DEFAULT_AUDIO_SINK@ 1
    muted=true
  fi
elif which pactl &>/dev/null; then
  if ! pactl get-sink-mute @DEFAULT_SINK@ | grep -q "Mute: yes"; then
    pactl set-sink-mute @DEFAULT_SINK@ on
    muted=true
  fi
elif which amixer &>/dev/null; then
  if ! amixer sget Master | grep -qE "Playback.*\[off\]$"; then
    amixer sset Master mute
    muted=true
  fi
else
  echo "Error: Cannot determine method to mute speakers"
fi

$muted && touch $XDG_RUNTIME_DIR/.speaker-mute
