#!/bin/sh

usage() {
  echo "usage: $(basename $0) [-h] [-P|-S SEARCH] command"
  echo "          -P        : Is parent process -- kill children too"
  echo "          -s SEARCH : Use SEARCH to find process to kill"
  exit $1
}

unset search
parent=0
[ "$1" = "-h" -o "$1" = "--help" ] && usage
[ -z "$1" ] && usage 1
[ "$1" = "-P" ] && shift && parent=1
[ "$1" = "-S" ] && shift && search=$1 && shift

cmd=$1
if [ -n "$search" ]; then
  pgrep -u $LOGNAME -f -- "$search" && \
    pkill -u $LOGNAME -f -- "$search" || \
    $* &
elif [ $parent = 0 ]; then
  pgrep -u $LOGNAME -x -- $cmd && \
    pkill -u $LOGNAME -x -- $cmd || \
    $* &
else
  p=$(pgrep -u $LOGNAME -x -- $cmd) && \
    pkill -u $LOGNAME -P $p || \
    $* &
fi
