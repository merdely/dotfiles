#!/bin/sh

# Sync my dotfiles into the dotfiles repo
CONFIGS=(
  $HOME/.config/fuzzy-chooser.conf
  $HOME/.config/kitty/
  $HOME/.config/local/waybar*
  $HOME/.config/local/wb_*
  $HOME/.config/niri/config.kdl
  $HOME/.config/niri/scripts/
  $HOME/.config/nvim/
  $HOME/.config/nwg-drawer/
  $HOME/.config/shell/merdely.profile
  $HOME/.config/starship.toml
  $HOME/.config/swayidle
  $HOME/.config/swaylock
  $HOME/.config/systemd/user/lisgd.service
  $HOME/.config/systemd/user/screen-rotation.service
  $HOME/.config/systemd/user/squeekboard.service
  $HOME/.config/systemd/user/swaybg.service
  $HOME/.config/systemd/user/swayidle.service
  $HOME/.config/systemd/user/syncthingtray.service
  $HOME/.config/systemd/user/watch-tablet.service
  $HOME/.config/systemd/user/wl-clip-persist.service
  $HOME/.config/systemd/user/wl-paste.service
  $HOME/.config/systemd/user/wm-session.target
  $HOME/.config/tmux/tmux.conf
  $HOME/.config/vim/vimrc
  $HOME/.config/waybar/
  $HOME/.config/wleave/
  $HOME/.config/wlogout/
  $HOME/.config/zsh/.zshrc

  $HOME/.bashrc
  $HOME/.zprofile

)

SCRIPTS=(
  /srv/scripts/bin/mic-mute
  /srv/scripts/bin/mic-unmute
  /srv/scripts/bin/play-pause-media
  /srv/scripts/bin/speaker-mute
  /srv/scripts/bin/speaker-unmute
  /srv/scripts/bin/tmux_groupssh
  /srv/scripts/bin/tmux_reorder
  /srv/scripts/bin/tmux_winsplit
  /srv/scripts/bin/wm-*
  /srv/scripts/bin/yad-askpass
)

# add files in the format of --exclude="pat" or --exclude="/path/to/file"
EXCLUDE=(
  --exclude='*~'
  --exclude='*.bad'
  --exclude='*.bak'
  --exclude='*.lock'
  --exclude='*.old'
  --exclude='*.orig'
  --exclude='*.testing'
  --exclude='*.tmp'
)

unset dryrun
[ "$1" = "--dry-run" ] && dryrun="--dry-run"
[ "$1" = "-n" ] && dryrun="--dry-run"

dest_dir=$(dirname "$(realpath "$0")")

tmpfile=$(mktemp)
printf "%s\n" "${CONFIGS[@]/#${HOME}\//}" > $tmpfile

rsync -a --info=NAME --recursive --relative --delete $dryrun "${EXCLUDE[@]}" --files-from=$tmpfile $HOME/ $dest_dir/
rsync -a --info=NAME --recursive --relative --delete $dryrun "${EXCLUDE[@]}" "${SCRIPTS[@]}" $dest_dir/
rm -f $tmpfile
