#!/bin/sh

[ -r $XDG_CONFIG_HOME/fuzzy-chooser.conf ] && source $XDG_CONFIG_HOME/fuzzy-chooser.conf
[ -z "$chooser" ] && chooser=$fuzzy_chooser

unset pswitch parg fset rset
while getopts ":hp:fr" opt; do
  case $opt in
    f)
      chooser=fuzzel
      fset=1
      ;;
    r)
      chooser=rofi
      rset=1
      ;;
    p)
      pswitch="-p"
      parg="$OPTARG"
      ;;
    *)
      echo "usage: $(basename $0) [-h] [-p PROMPT] [-f|-r]"
      exit
      ;;
  esac
done
shift $((OPTIND -1))

if [ -n "$fset" ] && [ -n "$rset" ]; then
  echo "Error: Only one of -f and -r can be specified"
  exit 1
fi

[ "$chooser" = fuzzel ] && [ -n "$parg" ] && parg="$parg "

if [ "$chooser" = fuzzel ]; then
  cat - | fuzzel -d $pswitch "$parg"
else
  cat - | rofi -dmenu $pswitch "$parg"
fi
