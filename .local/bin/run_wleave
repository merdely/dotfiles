#!/bin/bash

open_wleave() {
  open_cmd=wleave
  opts="-f -m 330 -b 4"
  rot_opts="-f -m 330 -b 2"
  case $XDG_CURRENT_DESKTOP in
    sway*)
      xform=$(swaymsg -r -t get_outputs | jq -r '.[] | select(.focused == "true" | .transform')
      if [[ $xform = 90 ]] || [[ $xform = 270 ]]; then
        opts=$rot_opts
      fi
      swaymsg exec $open_cmd $opts &
      ;;
    niri*)
      xform=$(niri msg -j outputs | jq -r '.[].logical.transform')
      if [[ $xform = 90 ]] || [[ $xform = 270 ]]; then
        opts=$rot_opts
      fi
      niri msg action spawn -- $open_cmd $opts &
      ;;
    Hyprland)
      xform=$(hyprctl monitors -j | jq -r '.[] | select(.focused == true) | .transform')
      if [[ $((xform % 2)) = 1 ]]; then
        opts=$rot_opts
      fi
      hyprctl dispatch exec $open_cmd $opts &
      ;;
    *) exec $open_cmd $opts & ;;
  esac
}

pgrep -u $LOGNAME -x wleave && pkill -u $LOGNAME -x wleave || open_wleave
