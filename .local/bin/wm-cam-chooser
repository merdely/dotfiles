#!/usr/bin/env bash

[ -r $XDG_CONFIG_HOME/fuzzy-chooser.conf ] && source $XDG_CONFIG_HOME/fuzzy-chooser.conf
[ -z "$chooser" ] && chooser=$fuzzy_chooser

camlist="󰞮  Garage Camera	garagecam
󰞮  Backyard Camera	backyardcam
󰕰  Back View	backview
󰕰  Front View	frontview
󰞮  Front Door Camera	frontdoorcam
󰞮  Front Door Camera 2	frontdoorcam2
󰞮  Shed Camera	shedcam
󰞮  Chimney Camera	chimneycam
󰞮  Close Camera Window	quit"

pgrep -u $LOGNAME -f -- "([r]ofi|[f]uzzel) -p View Camera ?>? ? -d(menu)?" && \
  pkill -u $LOGNAME -f -- "([r]ofi|[f]uzzel) -p View Camera ?>? ? -d(menu)?" || \
    choice=$(
      if [ $chooser = fuzzel ]; then
        echo "$camlist" | fuzzel -p "View Camera > " -d --with-nth=1 --accept-nth=2 --cache=$HOME/.cache/fuzzel_cams
      else
        echo "$camlist" | rofi -p "View Camera" -dmenu -i -display-columns 1 -display-column-separator '\t' -cache-dir $HOME/.cache/rofi_cams
      fi
    )

[ -z "$choice" -o "$choice" = -1 ] && exit 0

if [ $chooser = fuzzel ]; then
  cam=$choice
else
  cam=$(echo "$choice" | awk -F'\t' '{print $2}')
fi

if [ "$1" = -t ]; then
  echo "cam='$cam'"
  exit
fi

if [ "$cam" = quit ]; then
  pkill -f "mpv .*--(x11-name|title)=mpvcam"
else
  pkill -f "mpv .*--(x11-name|title)=mpvcam"
  $HOME/.local/bin/viewcamera $* $cam &
fi

